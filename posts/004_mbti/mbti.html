<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.24">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Alina">
<meta name="dcterms.date" content="2025-09-15">
<meta name="description" content="For Part 1, I am going to see if an LLM can give an accurate description of myself after I give it my MBTI">

<title>Testing LLMs on Personality Part 1: Can it provide a good description of someone given a personality type? ‚Äì Alina‚Äôs Blog</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dc55a5b9e770e841cd82e46aadbfb9b0.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-ca6ef412952242cddf6c3fdbe739bbca.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Alina‚Äôs Blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Testing LLMs on Personality Part 1: Can it provide a good description of someone given a personality type?</h1>
                  <div>
        <div class="description">
          For Part 1, I am going to see if an LLM can give an accurate description of myself after I give it my MBTI
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">LLMs</div>
                <div class="quarto-category">MBTI</div>
                <div class="quarto-category">Personality Test</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Alina </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">September 15, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="part-test" class="level2">
<h2 class="anchored" data-anchor-id="part-test">2 Part Test</h2>
<section id="part-1.-can-one-llm-chatgpt-5-give-an-accurate-description-given-a-specific-personality-type" class="level5">
<h5 class="anchored" data-anchor-id="part-1.-can-one-llm-chatgpt-5-give-an-accurate-description-given-a-specific-personality-type">Part 1. Can one LLM (ChatGPT 5) give an accurate description given a specific personality type?</h5>
</section>
<section id="part-2.-can-another-llm-microsoft-copilot-predict-the-correct-mbti-after-feeding-its-descriptions-back-to-itself" class="level5">
<h5 class="anchored" data-anchor-id="part-2.-can-another-llm-microsoft-copilot-predict-the-correct-mbti-after-feeding-its-descriptions-back-to-itself">Part 2. Can another LLM (Microsoft Copilot) predict the correct MBTI after feeding its descriptions back to itself?</h5>
<p><img src="snoopy_moods.png" class="img-fluid"></p>
</section>
</section>
<section id="what-is-mbti" class="level2">
<h2 class="anchored" data-anchor-id="what-is-mbti">What is MBTI?</h2>
<p>MBTI stands for Myers-Briggs Type Indicator. It consists of a questionnaire to categorize people into 16 different ‚Äúpersonality types‚Äù.</p>
<section id="there-are-four-key-areas-of-focus" class="level3">
<h3 class="anchored" data-anchor-id="there-are-four-key-areas-of-focus">There are four key areas of focus:</h3>
<p><img src="mbti.png" class="img-fluid"></p>
<p>There are 16 combinations total and those correspond to the 16 personality types, which are grouped into four larger divisions.</p>
<section id="analysts" class="level5">
<h5 class="anchored" data-anchor-id="analysts">Analysts</h5>
<p>Architect, Logician, Commander, Debater</p>
</section>
<section id="diplomats" class="level5">
<h5 class="anchored" data-anchor-id="diplomats">Diplomats</h5>
<p>Advocate, Mediator, Protagonist, Campaigner</p>
</section>
<section id="sentinals" class="level5">
<h5 class="anchored" data-anchor-id="sentinals">Sentinals</h5>
<p>Logistician, Defender, Executive, Consul</p>
</section>
<section id="explorers" class="level5">
<h5 class="anchored" data-anchor-id="explorers">Explorers</h5>
<p>Virtuoso, Adventurer, Entrepreneur, Entertainer</p>
</section>
</section>
</section>
<section id="what-is-my-mbti-and-how-will-i-prompt-the-llm" class="level2">
<h2 class="anchored" data-anchor-id="what-is-my-mbti-and-how-will-i-prompt-the-llm">What is my MBTI and how will I prompt the LLM?</h2>
<p>My MBTI is ISTJ, which means that I am a ‚ÄôLogistician‚Äù.</p>
<section id="chat-gpt-5-prompt" class="level4">
<h4 class="anchored" data-anchor-id="chat-gpt-5-prompt">Chat-GPT 5 Prompt:</h4>
<blockquote class="blockquote">
<p>Write a detailed description and outline traits of someone with an ISTJ MBTI.</p>
</blockquote>
</section>
</section>
<section id="response" class="level2">
<h2 class="anchored" data-anchor-id="response">Response</h2>
<p><strong>ISTJ Personality Overview</strong></p>
<blockquote class="blockquote">
<p>Type Code: Introverted ‚Ä¢ Sensing ‚Ä¢ Thinking ‚Ä¢ Judging</p>
</blockquote>
<blockquote class="blockquote">
<p>Nickname: The Inspector / The Duty Fulfiller</p>
</blockquote>
<blockquote class="blockquote">
<p>Core Drive: Responsibility, reliability, and upholding commitments.</p>
</blockquote>
<blockquote class="blockquote">
<p>Dominant Function: Introverted Sensing (Si) ‚Üí relies on memory, routines, and trusted methods.</p>
</blockquote>
<blockquote class="blockquote">
<p>Auxiliary Function: Extraverted Thinking (Te) ‚Üí focuses on efficiency, logic, and practical systems.</p>
</blockquote>
<blockquote class="blockquote">
<p>ISTJs are known for being grounded, dependable, and meticulous. They often feel a strong sense of duty to follow through on promises, meet obligations, and maintain stability. They like order, clarity, and practicality in their world.</p>
</blockquote>
<p><strong>Key Traits of ISTJs</strong></p>
<blockquote class="blockquote">
<p>Dependable &amp; Responsible</p>
</blockquote>
<blockquote class="blockquote">
<p>Take obligations very seriously.</p>
</blockquote>
<blockquote class="blockquote">
<p>Known as people who can be counted on to deliver.</p>
</blockquote>
<blockquote class="blockquote">
<p>Detail-Oriented &amp; Practical</p>
</blockquote>
<blockquote class="blockquote">
<p>Value concrete facts over abstract theories.</p>
</blockquote>
<blockquote class="blockquote">
<p>Notice small inconsistencies that others may miss.</p>
</blockquote>
<blockquote class="blockquote">
<p>Structured &amp; Organized</p>
</blockquote>
<blockquote class="blockquote">
<p>Prefer planning ahead and sticking to schedules.</p>
</blockquote>
<blockquote class="blockquote">
<p>Thrive when rules, traditions, or systems are clearly defined.</p>
</blockquote>
<blockquote class="blockquote">
<p>Reserved but Steadfast</p>
</blockquote>
<blockquote class="blockquote">
<p>Introverted ‚Üí private with emotions, not quick to open up.</p>
</blockquote>
<blockquote class="blockquote">
<p>Quietly dedicated rather than showy.</p>
</blockquote>
<blockquote class="blockquote">
<p>Logical &amp; Objective</p>
</blockquote>
<blockquote class="blockquote">
<p>Make decisions based on facts and efficiency.</p>
</blockquote>
<blockquote class="blockquote">
<p>Less swayed by emotions unless they relate to their values/duty.</p>
</blockquote>
<blockquote class="blockquote">
<p>Traditional &amp; Loyal</p>
</blockquote>
<blockquote class="blockquote">
<p>Respectful of rules, hierarchy, and established practices.</p>
</blockquote>
<blockquote class="blockquote">
<p>Value stability in relationships and careers.</p>
</blockquote>
<p><strong>Strengths</strong></p>
<blockquote class="blockquote">
<p>Extremely reliable and trustworthy.</p>
</blockquote>
<blockquote class="blockquote">
<p>Excellent memory for details and past experiences.</p>
</blockquote>
<blockquote class="blockquote">
<p>Strong work ethic and perseverance.</p>
</blockquote>
<blockquote class="blockquote">
<p>Clear sense of duty and responsibility.</p>
</blockquote>
<blockquote class="blockquote">
<p>Loyal to people, institutions, and commitments.</p>
</blockquote>
<p><strong>Challenges</strong></p>
<blockquote class="blockquote">
<p>Can be rigid or resistant to change.</p>
</blockquote>
<blockquote class="blockquote">
<p>May come across as too serious or unexpressive.</p>
</blockquote>
<blockquote class="blockquote">
<p>Struggle with abstract or highly theoretical ideas.</p>
</blockquote>
<blockquote class="blockquote">
<p>Sometimes prioritize duty over personal needs.</p>
</blockquote>
<blockquote class="blockquote">
<p>Risk being overly critical (of self and others).</p>
</blockquote>
<p><strong>Work Style</strong></p>
<blockquote class="blockquote">
<p>Prefer clear expectations and step-by-step tasks.</p>
</blockquote>
<blockquote class="blockquote">
<p>Thrive in structured environments (law, finance, medicine, government, military, engineering, etc.).</p>
</blockquote>
<blockquote class="blockquote">
<p>Excel in roles requiring accuracy, consistency, and reliability.</p>
</blockquote>
<p><strong>Relationships</strong></p>
<blockquote class="blockquote">
<p>Show love through dependability and practical actions, not always words.</p>
</blockquote>
<blockquote class="blockquote">
<p>Value long-term stability over spontaneity.</p>
</blockquote>
<blockquote class="blockquote">
<p>Loyal, steady, and protective of their commitments.</p>
</blockquote>
<p><strong>‚ú® In short: An ISTJ is the type of person who keeps the world running smoothly ‚Äî grounded, diligent, and dependable, with a strong sense of tradition and order.</strong></p>
</section>
<section id="reflection" class="level2">
<h2 class="anchored" data-anchor-id="reflection">Reflection</h2>
<p>This part is more of a validation step for the next part as well as an investigation into how well LLMs understand the nuances of different persoality types beyond what is just directly stated. in terms of validity, I do see myself in a lot of these descriptions (it is my personality type after all). The ones that especially stood out to me were ‚ÄòChallenges‚Äô, ‚ÄòWork Style‚Äô, ‚ÄòRelationships‚Äô. I think these were extremely on the nose. I think one thing in particular doesn‚Äôt necessarily fit: ‚ÄúStruggle with Abstract or Theoretical Ideas‚Äù, but I think for me, this is a skill that came with time. Additionally, it has been a while since I‚Äôve gotten this result, so it is a possibility that I am no longer this ‚Äúpersonality‚Äù</p>
</section>
<section id="extra-prompt-for-fun" class="level2">
<h2 class="anchored" data-anchor-id="extra-prompt-for-fun">Extra Prompt (for fun)</h2>
<p><strong>Prompt:</strong> &gt; Do you think that there are only 16 personalities?</p>
<p><strong>ChatGPT 5 Response:</strong> &gt; Not really ‚Äî the idea of there being only <strong>16 personalities</strong> comes from the <strong>Myers-Briggs Type Indicator (MBTI)</strong>, which categorizes people based on four binary traits (Introvert/Extrovert, Intuitive/Sensing, Thinking/Feeling, Judging/Perceiving).</p>
<blockquote class="blockquote">
<p>That framework produces <strong>16 combinations</strong>, but:</p>
</blockquote>
<blockquote class="blockquote">
<ul>
<li><strong>Human personality is far more complex.</strong></li>
</ul>
</blockquote>
<blockquote class="blockquote">
<ul>
<li>Traits exist on spectrums, not binaries.</li>
<li>Two people of the ‚Äúsame type‚Äù can behave very differently depending on culture, upbringing, stress, etc.</li>
<li>Other models (like the <strong>Big Five</strong>) treat personality as continuous dimensions (e.g., Openness, Conscientiousness, Extraversion, Agreeableness, Neuroticism), which allows for many more nuanced combinations.</li>
<li>Neuroscience and psychology generally agree: personality is <strong>dynamic</strong>, not fixed ‚Äî it shifts with age, experience, and context.</li>
</ul>
</blockquote>
<blockquote class="blockquote">
<p>üëâ So while the ‚Äú16 personalities‚Äù model can be a fun and sometimes useful shorthand, it‚Äôs definitely an <strong>oversimplification</strong> of human diversity.</p>
</blockquote>
<blockquote class="blockquote">
<p>Would you like me to compare <strong>MBTI vs Big Five</strong> to show how they approach personality differently?</p>
</blockquote>
<p><strong>My Thoughts:</strong> I think it‚Äôs interesting how ChatGPT 5 was able to answer a question seemingly looking for an opinion. Additionally, I am surprised that it gave the answer ‚ÄúNot really‚Äù, because I was expecting it to deflect and give an answer in between two opinions, rather than leaning to one side. I am not sure how LLMs are programmed to act based on opinion-based questions, but I am intriguied that it took somewhat of a stance. I wonder how far its opinions will go?</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "Óßã";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/alinagu19\.github\.io\/comm4190_F25_Using_LLMs_Blog\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>